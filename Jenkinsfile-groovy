import groovy.io.FileType

@NonCPS
def collectFiles(File dir) {
  def fileList = []
  dir.eachFileRecurse(FileType.FILES) { file -> 
    fileList << file
  }
  return fileList
}

checkout scm
def files = collectFiles(new File("bella_playbooks"))

properties(
    [
        parameters([
                string(defaultValue: 'dev', name: 'DEPLOY_ENV'),
                choice(choices: files.join("\n"), name: "service")
        ])   
    ]
)  
node {
  env.TARGET = 'prod'
  stage('First stage'){
    echo "Hello from Scripted pipe with groovy on ${params.DEPLOY_ENV} ${params.service}"
  }
}
